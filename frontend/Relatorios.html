<!DOCTYPE html>
<html lang="pt-BR"> <!-- Define o idioma da p√°gina -->
<head>
    <meta charset="UTF-8"> <!-- Define o padr√£o de caracteres (UTF-8) -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Responsividade em celulares -->
    <title>Relat√≥rios de Vendas - Styllo Fashion Modas</title> <!-- T√≠tulo da aba do navegador -->

    <!-- Importa o arquivo CSS do seu projeto (pode ser o mesmo usado nas outras p√°ginas) -->
    <link rel="stylesheet" href="style.css">

    <!-- Importa a biblioteca Chart.js para criar os gr√°ficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <!-- O menu ser√° carregado automaticamente pelo arquivo frontend/auth.js -->
    <nav></nav>

    <!-- Conte√∫do principal da p√°gina -->
    <main class="container">
        <h1>üìä Relat√≥rios de Vendas</h1> <!-- T√≠tulo principal -->
        <p>Visualize o desempenho de vendas da loja por m√™s e por ano.</p> <!-- Texto explicativo -->

        <!-- Se√ß√£o do gr√°fico mensal -->
        <section class="relatorio-section">
            <h2>Vendas Mensais (2025)</h2> <!-- T√≠tulo do gr√°fico mensal -->
            <canvas id="graficoMensal"></canvas> <!-- √Årea onde o gr√°fico ser√° desenhado -->
        </section>

        <!-- Se√ß√£o do gr√°fico anual -->
        <section class="relatorio-section">
            <h2>Vendas Anuais (2021‚Äì2025)</h2> <!-- T√≠tulo do gr√°fico anual -->
            <canvas id="graficoAnual"></canvas> <!-- √Årea onde o gr√°fico ser√° desenhado -->
        </section>
    </main>

    <!-- Importa o script que monta o menu e verifica o login -->
    <script src="frontend/auth.js"></script>

    <script>
document.addEventListener('DOMContentLoaded', () => {
    // Fun√ß√£o que carrega as vendas do backend
    async function carregarVendas() {
        try {
            const resposta = await fetch('../backend/sales.json'); // caminho pro arquivo de vendas
            const vendas = await resposta.json(); // converte o JSON em objeto JS

            console.log('üì¶ Dados de vendas carregados:', vendas);

            // --- EXEMPLO DE PROCESSAMENTO ---
            // Aqui voc√™ adapta conforme a estrutura do seu sales.json
            // (vou supor que tem { data: "2025-03-01", total: 123.45 } em cada venda)

            // Agrupa por m√™s e por ano
            const vendasPorMes = Array(12).fill(0);
            const vendasPorAno = {};

            vendas.forEach(v => {
                const data = new Date(v.data);
                const mes = data.getMonth(); // 0 = janeiro
                const ano = data.getFullYear();

                vendasPorMes[mes] += v.total;
                vendasPorAno[ano] = (vendasPorAno[ano] || 0) + v.total;
            });

            const meses = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
            const anos = Object.keys(vendasPorAno).sort();

            // --- GR√ÅFICO MENSAL ---
            new Chart(document.getElementById('graficoMensal'), {
                type: 'bar',
                data: {
                    labels: meses,
                    datasets: [{
                        label: 'Vendas (R$)',
                        data: vendasPorMes,
                        borderWidth: 1,
                        backgroundColor: 'rgba(75, 192, 192, 0.6)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false },
                        title: { display: true, text: 'Vendas por M√™s' }
                    },
                    scales: { y: { beginAtZero: true } }
                }
            });

            // --- GR√ÅFICO ANUAL ---
            new Chart(document.getElementById('graficoAnual'), {
                type: 'line',
                data: {
                    labels: anos,
                    datasets: [{
                        label: 'Total Anual (R$)',
                        data: anos.map(a => vendasPorAno[a]),
                        borderColor: 'rgba(255, 99, 132, 1)',
                        backgroundColor: 'rgba(255, 99, 132, 0.2)',
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: { display: true, text: 'Crescimento de Vendas Anual' }
                    },
                    scales: { y: { beginAtZero: true } }
                }
            });

        } catch (erro) {
            console.error('‚ùå Erro ao carregar vendas:', erro);
            alert('N√£o foi poss√≠vel carregar os dados de vendas.');
        }
    }

    // Chama a fun√ß√£o ao abrir a p√°gina
    carregarVendas();

    // Atualiza automaticamente a cada 1 minuto
    setInterval(carregarVendas, 60000);
});
</script>


    <!-- CSS interno apenas para essa p√°gina (pode colocar no style.css se preferir) -->
    <style>
        /* Define o estilo geral da p√°gina */
        body {
            font-family: Arial, sans-serif; /* Fonte usada no texto */
            background: #fafafa; /* Cor de fundo clara */
            margin: 0; /* Remove margens externas */
            padding: 0; /* Remove espa√ßamento interno */
        }

        /* Define a √°rea principal */
        .container {
            padding: 2rem; /* Espa√ßamento interno */
        }

        /* Estilo do t√≠tulo principal */
        h1 {
            text-align: center; /* Centraliza o texto */
            margin-bottom: 1rem; /* Espa√ßo abaixo do t√≠tulo */
        }

        /* Cada bloco de relat√≥rio (gr√°fico) */
        .relatorio-section {
            background: #fff; /* Fundo branco */
            border-radius: 12px; /* Cantos arredondados */
            padding: 1.5rem; /* Espa√ßamento interno */
            box-shadow: 0 3px 8px rgba(0,0,0,0.1); /* Sombra leve */
            margin: 1.5rem auto; /* Centraliza e adiciona espa√ßamento vertical */
            max-width: 800px; /* Largura m√°xima */
        }

        /* Define o tamanho do canvas (gr√°fico) */
        canvas {
            width: 100%; /* Ocupa toda a largura do bloco */
            height: 400px; /* Altura fixa dos gr√°ficos */
        }
    </style>
</body>
</html>
